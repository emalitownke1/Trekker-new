name: Restore to Specific Commit

on:
  # Trigger manually from GitHub UI
  workflow_dispatch:
    inputs:
      confirm_restore:
        description: 'Type "CONFIRM" to proceed with restore'
        required: true
        default: ''
      
  # Or trigger on push to a specific branch
  # push:
  #   branches: [ restore-trigger ]

jobs:
  restore-commit:
    runs-on: ubuntu-latest
    
    steps:
    - name: Validate confirmation
      if: github.event.inputs.confirm_restore != 'CONFIRM'
      run: |
        echo "âŒ Restore not confirmed. Please type 'CONFIRM' to proceed."
        exit 1
    
    - name: Checkout specific commit
      uses: actions/checkout@v4
      with:
        ref: f42d6770c2e5a63d2d1974072a0be9314df86989
        fetch-depth: 0  # Fetch full history
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Display commit information
      run: |
        echo "ðŸ“‹ Current commit details:"
        git log --oneline -1
        echo ""
        echo "ðŸ“Š Repository status:"
        git status
    
    - name: Create restore branch
      run: |
        # Create a new branch from this commit
        BRANCH_NAME="restore-$(date +%Y%m%d-%H%M%S)"
        git checkout -b "$BRANCH_NAME"
        echo "âœ… Created branch: $BRANCH_NAME"
        echo "RESTORE_BRANCH=$BRANCH_NAME" >> $GITHUB_ENV
    
    - name: Push restore branch
      run: |
        git push origin "$RESTORE_BRANCH"
        echo "âœ… Pushed restore branch: $RESTORE_BRANCH"
    
    - name: Reset main/master branch (optional)
      if: github.event.inputs.reset_main == 'true'
      run: |
        # Uncomment and modify as needed
        # git checkout main  # or master
        # git reset --hard f42d6770c2e5a63d2d1974072a0be9314df86989
        # git push --force-with-lease origin main
        echo "âš ï¸  Main branch reset is disabled. Enable in workflow if needed."
    
    - name: Create summary
      run: |
        echo "## ðŸ”„ Restore Summary" >> $GITHUB_STEP_SUMMARY
        echo "- **Target Commit**: \`f42d6770c2e5a63d2d1974072a0be9314df86989\`" >> $GITHUB_STEP_SUMMARY
        echo "- **Restore Branch**: \`$RESTORE_BRANCH\`" >> $GITHUB_STEP_SUMMARY
        echo "- **Status**: âœ… Successfully restored" >> $GITHUB_STEP_SUMMARY
        echo "" >> $GITHUB_STEP_SUMMARY
        echo "### Next Steps:" >> $GITHUB_STEP_SUMMARY
        echo "1. Review the restored code in branch \`$RESTORE_BRANCH\`" >> $GITHUB_STEP_SUMMARY
        echo "2. Create a pull request if you want to merge these changes" >> $GITHUB_STEP_SUMMARY
        echo "3. Or manually merge/reset your target branch as needed" >> $GITHUB_STEP_SUMMARY
